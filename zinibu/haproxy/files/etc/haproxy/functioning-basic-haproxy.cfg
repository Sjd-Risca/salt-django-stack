# HAProxy configuration
#
# **** DO NOT EDIT THIS FILE ****
#
# This file is managed by Salt.
# Any changes will be overwritten.

#------------------
# Global settings
#------------------
global
    log /dev/log    local0
    log /dev/log    local1 notice
    user haproxy
    group haproxy
    chroot  /var/lib/haproxy
    daemon
    stats socket /var/lib/haproxy/stats
    ssl-default-bind-ciphers	ECDHE-RSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES128-SHA256:ECDHE-RSA-AES256-SHA384
    ssl-default-bind-options	no-sslv3 no-tlsv10 no-tlsv11

#------------------
# common defaults that all the 'listen' and 'backend' sections will
# use- if not designated in their block
#------------------
defaults
    log global
    mode http
    retries 3
    balance roundrobin
    option	httplog
    option	dontlognull
    option	forwardfor
    option	http-server-close
    timeout http-request    10s
    timeout queue           1m
    timeout connect         10s
    timeout client          1m
    timeout server          1m
    timeout http-keep-alive 10s
    timeout check           10s
    stats	enable
    stats uri	/admin?stats
    stats realm	Haproxy\ Statistics
    stats auth	admin1:AdMiN123
    errorfile 400 /etc/haproxy/errors/400.http
    errorfile 504 /etc/haproxy/errors/504.http
    errorfile 403 /etc/haproxy/errors/403.http
    errorfile 500 /etc/haproxy/errors/500.http
    errorfile 502 /etc/haproxy/errors/502.http
    errorfile 503 /etc/haproxy/errors/503.http
    errorfile 408 /etc/haproxy/errors/408.http


#------------------
# listen instances
#------------------
#listen myservice
#    bind *:8888
#    option forwardfor
#    option http-server-close
#    default-server maxqueue 128  maxconn 256  slowstart 60s  weight 100 
#    server web2 web2.example.com:18888 check 
#    server web1 web1.example.com:80 check 
  
listen stats
    bind 0.0.0.0:8998
    mode http
    stats enable
    stats uri /admin?stats
    stats refresh 20s
    stats auth admin:secret
  


#------------------
# frontend instances
#------------------
frontend www-http
    bind	*:80
#    redirect	scheme https if !{ ssl_fc }
    default_backend www-backend
  


#------------------
# backend instances
#------------------
backend www-backend
    balance roundrobin
# pure nginx/gunicorn
    server server1-its-name 192.168.33.15:81 check 
    server server2-its-name 192.168.33.16:81 check 
# via varnish
#    server server1-its-name 192.168.33.15:83 check 
  
#backend static-backend
#    balance roundrobin
#    option http-server-close
#    option httpclose
#    option forwardfor    except 127.0.0.0/8
#    option httplog
#    cookie pm insert indirect
#    stats enable
#    stats realm LoadBalancer
#    stats uri /url/to/stats
#    stats auth user:password
#    server some-server 192.168.33.16:81 check 
#  
